# AppView Configuration
# Copy this to .env and customize as needed

# ============================================================================
# CONSTELLATION INTEGRATION - Phase 2
# ============================================================================
# Constellation provides accurate, network-wide interaction statistics
# Phase 2 includes local self-hosted instance with Docker workers

# Enable/disable Constellation integration
CONSTELLATION_ENABLED=true

# Constellation API URL
# - Local instance (default, included in docker-compose): http://constellation-local:8080
# - Remote public API: https://constellation.microcosm.blue
CONSTELLATION_URL=http://constellation-local:8080

# Is this a local instance? (auto-detected, but can override)
CONSTELLATION_LOCAL=true

# API timeout (milliseconds)
CONSTELLATION_TIMEOUT=10000

# Cache TTL (seconds) - lower for local (faster), higher for remote
CONSTELLATION_CACHE_TTL=30

# Rate limiting (only for remote API)
CONSTELLATION_REQUEST_DELAY=100
CONSTELLATION_MAX_RETRIES=3
CONSTELLATION_RETRY_DELAY=1000
CONSTELLATION_MAX_RPS=100

# Local Constellation Configuration (Phase 2)
# These settings apply to the local constellation-local service

# Jetstream endpoint (AT Protocol firehose)
# Choose closest region for best performance:
#   wss://jetstream1.us-east.bsky.network/subscribe (US East primary)
#   wss://jetstream2.us-east.bsky.network/subscribe (US East secondary, recommended)
#   wss://jetstream1.us-west.bsky.network/subscribe (US West)
JETSTREAM_URL=wss://jetstream2.us-east.bsky.network/subscribe

# Constellation API port (exposed on host)
CONSTELLATION_PORT=8080

# Resource limits for local instance
CONSTELLATION_MEMORY_LIMIT=2G
CONSTELLATION_MEMORY_RESERVATION=512M

# Logging level (trace, debug, info, warn, error)
CONSTELLATION_LOG_LEVEL=info

# Constellation version (git branch/tag from microcosm-rs)
CONSTELLATION_VERSION=main

# Osprey Integration (federated labeling)
OSPREY_ENABLED=false

# Backfill Configuration
# Set BACKFILL_DAYS to automatically run historical backfill when the system starts
# 0 = disabled (no backfill)
# -1 = total backfill (entire available history)
# >0 = backfill X days of history (e.g., 7 for last 7 days)
BACKFILL_DAYS=0

# Backfill Resource Throttling (optional - defaults shown below)
# Uncomment and adjust based on your server's capacity
# BACKFILL_BATCH_SIZE=5              # Events to process before delaying
# BACKFILL_BATCH_DELAY_MS=2000       # Milliseconds to wait between batches
# BACKFILL_MAX_CONCURRENT=2          # Maximum concurrent processing operations
# BACKFILL_MAX_MEMORY_MB=512         # Pause if memory exceeds this limit
# BACKFILL_USE_IDLE=true             # Use idle processing time
# BACKFILL_DB_POOL_SIZE=2            # Database connection pool size for backfill

# Data Retention
DATA_RETENTION_DAYS=0
